<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Java's Ghost JVMs - Eldelshell Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <link href="http://eldelshell.github.io/static/images/favicon.ico" rel="icon">
    
                            <!-- Open Graph tags -->
                            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Java's Ghost JVMs"/>
            <meta property="og:url" content="http://eldelshell.github.io/javas-ghost-jvms.html"/>
            <meta property="og:description" content="It's a nice day when you end up digging through some of the JDK source code to find out what is broken with one of the JDK tools like JPS or JConsole. Today was one of those days. The problem was with our JBoss monitoring tool which depends on ..."/>
            
    <!-- Bootstrap -->
            <link rel="stylesheet" href="http://eldelshell.github.io/theme/css/bootstrap.flatly.min.css" type="text/css"/>
        <link href="http://eldelshell.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://eldelshell.github.io/theme/css/pygments/native.css" rel="stylesheet">
            <link rel="stylesheet" href="http://eldelshell.github.io/theme/css/style.css" type="text/css"/>
    
            <link href="http://eldelshell.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Eldelshell Blog ATOM Feed"/>
        
            <!-- SEO: g+ -->
        <link rel="author" href="https://plus.google.com/+AlejandroAyuso"/>
    		

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://eldelshell.github.io/" class="navbar-brand">
                                Eldelshell Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                                                                             <li><a href="http://eldelshell.github.io/pages/about-me.html">
                             About me & About this blog
                          </a></li>
                                                                                                  <li class="active">
                            <a href="http://eldelshell.github.io/category/blog.html">Blog</a>
                        </li>
                                                </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://eldelshell.github.io/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
                <div class="col-sm-9">
                    
            <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://eldelshell.github.io/javas-ghost-jvms.html"
                       rel="bookmark"
                       title="Permalink to Java's Ghost JVMs">
                        Java's Ghost JVMs
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
                        <footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2011-10-19T00:00:00"> Wed 19 October 2011</time>
    </span>
                    
            
    
    <span class="label label-default">Tags</span>
	<a href="http://eldelshell.github.io/tag/java.html">Java</a>
            
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>It's a nice day when you end up digging through some of the JDK source code to find out what is broken with one of the JDK tools like JPS or JConsole. Today was one of those days.</p>
<p>The problem was with our JBoss monitoring tool which depends on jconsoles LocalVirtualMachine.getAllVirtualMachines() method. For some reason, after a controlled restart of the farm, a couple of servers were being reported as offline. Looking at the log files, I was able to see that the PID for this servers was wrong and the process couldn't connect to retrieve the data (this is done using JMX).</p>
<p>The solution was to see what this method was doing with the source code from <a href="http://www.java2s.com/Open-Source/Java-Document/6.0-JDK-Modules-sun/jvmstat/sun/jvmstat/perfdata/monitor/protocol/local/LocalVmManager.java.htm">LocalVmManager.java</a> and <a href="http://javasourcecode.org/html/open-source/jdk/jdk-5.0/sun/jvmstat/perfdata/monitor/protocol/local/PerfDataFile.java.html">PerfDataFile.java</a></p>
<p>So how does tools like JPS, JConsole or VisualVM know the JVMs running in a system? They simply look in the folder <code>/tmp/hsperfdata_foo</code> where a 32KB data file with the PID as name is created for each JVM.</p>
<p><img alt="" src="http://eldelshell.github.io/static/images/screenshot_215.png" /></p>
<p>Back to our problem. After the restart, some of the files that should have been removed when the JVM was killed were still there, so this was giving the monitoring process a wrong PID and it couldn't connect to the JVM and do its magic.</p>
<p>Solution: remove the unused files and everything works as expected.</p>
<p>So, the next time you need to know all the JVM running on your system, remember this: <code>$ls /tmp/hsperfdata_*/</code></p>
            </div>
            <!-- /.entry-content -->
                                            </article>
    </section>

        </div>
	        <div class="col-sm-3 well well-sm" id="sidebar">
                
<aside>
    <section>
        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                                        <li class="list-group-item"><a href="http://twitter.com/Eldelshell"><i
                            class="fa fa-twitter-square fa-lg"></i> Twitter
                    </a></li>
                                        <li class="list-group-item"><a href="https://plus.google.com/+AlejandroAyuso?rel=author"><i
                            class="fa fa-google-plus-square fa-lg"></i> Google+
                    </a></li>
                                        <li class="list-group-item"><a href="http://stackoverflow.com/users/48869/eldelshell"><i
                            class="fa fa-stackexchange-square fa-lg"></i> StackExchange
                    </a></li>
                                        <li class="list-group-item"><a href="http://es.linkedin.com/in/alejandroayuso/"><i
                            class="fa fa-linkedin-square fa-lg"></i> LinkedIn
                    </a></li>
                                        <li class="list-group-item"><a href="http://eldelshell.github.io/feeds/all.atom.xml"><i
                            class="fa fa-rss-square fa-lg"></i> RSS
                    </a></li>
                                      </ul>
                </li>
            
            
            
                            <li class="list-group-item"><a href="http://eldelshell.github.io/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group" id="tags">
                                            <li class="list-group-item tag-1">
                            <a href="http://eldelshell.github.io/tag/java.html">
                                Java
                            </a>
                        </li>
                                            <li class="list-group-item tag-1">
                            <a href="http://eldelshell.github.io/tag/play.html">
                                Play!
                            </a>
                        </li>
                                            <li class="list-group-item tag-2">
                            <a href="http://eldelshell.github.io/tag/linux.html">
                                Linux
                            </a>
                        </li>
                                            <li class="list-group-item tag-2">
                            <a href="http://eldelshell.github.io/tag/tomcat.html">
                                Tomcat
                            </a>
                        </li>
                                            <li class="list-group-item tag-2">
                            <a href="http://eldelshell.github.io/tag/flask.html">
                                flask
                            </a>
                        </li>
                                            <li class="list-group-item tag-3">
                            <a href="http://eldelshell.github.io/tag/jinja2.html">
                                jinja2
                            </a>
                        </li>
                                            <li class="list-group-item tag-3">
                            <a href="http://eldelshell.github.io/tag/bootstrap.html">
                                bootstrap
                            </a>
                        </li>
                                            <li class="list-group-item tag-3">
                            <a href="http://eldelshell.github.io/tag/java.html">
                                java
                            </a>
                        </li>
                                            <li class="list-group-item tag-3">
                            <a href="http://eldelshell.github.io/tag/python.html">
                                python
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/pelican.html">
                                pelican
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/wicket.html">
                                wicket
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/geeksphone.html">
                                geeksphone
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/jenkins.html">
                                Jenkins
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/jackson.html">
                                Jackson
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/less.html">
                                less
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/jboss.html">
                                JBoss
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/netbeans.html">
                                netbeans
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/logback.html">
                                logback
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/big-data.html">
                                big-data
                            </a>
                        </li>
                                            <li class="list-group-item tag-4">
                            <a href="http://eldelshell.github.io/tag/shell.html">
                                Shell
                            </a>
                        </li>
                                        </ul>
                </li>    
                                                
        </ul>
    </section>

</aside>        </div>
	    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
                                       <div class="col-xs-10">&copy; 2014 Eldelshell
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                            <p><small>            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
        Content
    licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
                     </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="//code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://eldelshell.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://eldelshell.github.io/theme/js/respond.min.js"></script>

    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-50208536-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>

<!-- https://developers.google.com/custom-search/docs/structured_data?hl=es&csw=1#microformats -->
<!--
<PageMap>
<DataObject type="document">
    <Attribute name="title">Java's Ghost JVMs</Attribute>
    <Attribute name="author">Eldelshell</Attribute>
    <Attribute name="description">It's a nice day when you end up digging through some of the JDK source code to find out what is broken with one of the JDK tools like JPS or JConsole. Today was one of those days. The problem was with our JBoss monitoring tool which depends on ...</Attribute>
    <Attribute name="page_count">1</Attribute>
    <Attribute name="rating">5</Attribute>
    <Attribute name="last_update">2011-10-19T00:00:00</Attribute>
</DataObject>
<DataObject type="metatags">
    <Attribute name="category" value="Blog"/>
            <Attribute name="category" value="Java"/>
    </DataObject>


--></body>
</html>